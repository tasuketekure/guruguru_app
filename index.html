
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ぐるぐるのおんがくの部屋</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: "メイリオ", sans-serif;
            text-align: center;
            padding: 2em;
        }
        input, textarea, button {
            margin: 0.5em;
            width: 80%;
            padding: 0.5em;
            font-size: 1em;
        }
        img {
            width: 200px;
            margin: 1em 0;
        }
    </style>
</head>
<body>
    <h2>「とーくん、ぐるぐるの……おんがくの部屋へようこそ……」</h2>
    <img src="guruguru_new.png" alt="ぐるぐる">

    <p>Spotify Client ID と Secret を入力して、ぐるぐるにトークン取ってもらおうね……</p>
    <input type="text" id="clientId" placeholder="Client ID">
    <input type="text" id="clientSecret" placeholder="Client Secret">
    <div id="tokenStatus">とーくん……とーくんのぶんのトークン……とってくる……</div>

    <p>SpotifyプレイリストのURLを貼ってね……</p>
    <textarea id="playlistUrl" rows="2" placeholder="https://open.spotify.com/playlist/..."></textarea>
    <p>または、曲名とアーティストを改行でまとめて貼ってもいいよ……</p>
    <textarea id="manualTracks" rows="5" placeholder="曲名 アーティスト名
曲名 アーティスト名..."></textarea>

    <input type="text" id="playlistName" placeholder="プレイリストの名前……">

    <button onclick="createPlaylist()">プレイリストをつくる</button>
    <button onclick="convertToText()">テキストにする……</button>

    <pre id="output"></pre>

    <script>
        async function getToken(clientId, clientSecret) {
            const response = await fetch('https://accounts.spotify.com/api/token', {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + btoa(clientId + ':' + clientSecret),
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'grant_type=client_credentials'
            });
            const data = await response.json();
            return data.access_token;
        }

        async function convertToText() {
            const url = document.getElementById("playlistUrl").value.trim();
            const clientId = document.getElementById("clientId").value.trim();
            const clientSecret = document.getElementById("clientSecret").value.trim();
            const token = await getToken(clientId, clientSecret);
            const playlistId = url.split("playlist/")[1]?.split("?")[0];
            const res = await fetch(`https://api.spotify.com/v1/playlists/${playlistId}/tracks`, {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            const data = await res.json();
            const output = data.items.map(i => {
                const name = i.track.name;
                const artists = i.track.artists.map(a => a.name).join(', ');
                return `${name} - ${artists}`;
            }).join("\n");
            document.getElementById("output").textContent = output;
        }

        function createPlaylist() {
            document.getElementById("output").textContent = "プレイリスト作成機能は後日実装……ごめんね……";
        }
    </script>
</body>
</html>
